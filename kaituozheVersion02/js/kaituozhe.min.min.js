var app=angular.module("ktz",["ng","ngRoute","ngAnimate"]);app.factory("$debounce",["$rootScope","$browser","$q","$exceptionHandler",function(i,j,n,m){var k={},o={},l=0;function p(c,f,e){var a=n.defer(),v=a.promise,h=(angular.isDefined(e)&&!e),b,u,d,t=false;angular.forEach(o,function(q,r){if(angular.equals(o[r].fn,c)){t=true;d=r}});if(!t){d=l++;o[d]={fn:c}}else{k[o[d].timeoutId].reject("bounced");j.defer.cancel(o[d].timeoutId)}var g=function(){delete o[d];try{a.resolve(c())}catch(q){a.reject(q);m(q)}if(!h){i.$apply()}};b=j.defer(g,f);o[d].timeoutId=b;u=function(q){delete k[v.$$timeoutId]};v.$$timeoutId=b;k[b]=a;v.then(u,u);return v}p.cancel=function(a){if(a&&a.$$timeoutId in k){k[a.$$timeoutId].reject("canceled");return j.defer.cancel(a.$$timeoutId)}return false};return p}]);app.config(function(b){b.when("/ktzStart",{templateUrl:"tpl/start.html"}).when("/ktzLogin",{templateUrl:"tpl/login.html",controller:"loginCtrl"}).when("/ktzRegister",{templateUrl:"tpl/register.html",controller:"registerCtrl"}).when("/ktzMain",{templateUrl:"tpl/main.html",controller:"mainCtrl"}).when("/ktzDetail/:kid",{templateUrl:"tpl/detail.html",controller:"detailCtrl"}).when("/ktzPay/:kid",{templateUrl:"tpl/pay.html",controller:"payCtrl"}).when("/ktzPersonal",{templateUrl:"tpl/personal.html",controller:"personalCtrl"}).when("/ktzFind",{templateUrl:"tpl/find.html"}).otherwise({redirectTo:"/ktzStart"})});app.controller("parentCtrl",["$scope","$location",function(d,c){d.jump=function(a){c.path(a)}}]);app.controller("mainCtrl",["$scope","$http","$debounce",function(e,f,d){e.hasMore=true;f.get("data/kind_getbypage.php").success(function(a){e.kindList=a});e.loadMore=function(){f.get("data/kind_getbypage.php?start="+e.kindList.length).success(function(a){if(a.length<5){e.hasMore=false}e.kindList=e.kindList.concat(a)})};e.$watch("kw",function(){d(watchHandler,500)});watchHandler=function(){if(e.kw){f.get("data/kind_getbykw.php?kw="+e.kw).success(function(a){e.kindList=a})}}}]);app.controller("detailCtrl",["$scope","$routeParams","$http",function(e,d,f){f.get("data/kind_getbyid.php?id="+d.kid).success(function(a){e.kind=a[0]})}]);app.controller("payCtrl",["$scope","$routeParams","$http",function(e,d,f){console.log(d);f.get("data/kind_getbyid.php?id="+d.kid).success(function(a){if(a.length>0){e.kind=a[0]}});e.submitOrder=function(){console.log(d.kid);e.oid=localStorage.getItem("oid");f.get("data/class_add.php?kid="+d.kid+"&oid="+e.oid).success(function(a){e.result=a[0];console.log(e.result);if(a.length>0){if(e.result.msg=="succ"){e.succMsg="添加课程成功，订单编号为"+e.result.oid}else{e.errMsg="添加课程失败!"}}})}}]);app.controller("registerCtrl",["$scope","$httpParamSerializerJQLike","$http","$location",function(f,e,g,h){f.reg={};f.loginUser=function(){f.result=e(f.reg);console.log(f.result);g.get("data/user_register.php?"+f.result).success(function(a){console.log(a);localStorage.setItem("phone",f.reg.phone);localStorage.setItem("oid",a[0].oid)});h.path("/ktzLogin")}}]);app.controller("personalCtrl",["$scope","$http",function(d,c){d.phone=localStorage.getItem("phone");d.oid=localStorage.getItem("oid");console.log(d.phone);console.log(d.oid);c.get("data/myclass.php?phone="+d.phone).success(function(a){console.log(a);d.orderList=a})}]);app.controller("loginCtrl",["$scope","$http","$location",function(e,f,d){e.loginClick=function(){f.get("data/user_login.php?name="+e.name+"&pwd="+e.pwd).success(function(a){console.log(a);if(a.msg=="succ"){d.path("/ktzMain")}else{}})}}]);