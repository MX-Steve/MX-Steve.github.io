$(document).ready(function(){fiveChess.init()});var fiveChess={NO_CHESS:0,BLACK_CHESS:-1,WHITE_CHESS:1,chessArr:[],chessBoardHtml:"",humanPlayer:"black",AIPlayer:"white",isPlayerTurn:true,totalGames:cookieHandle.getCookie("totalGames")||0,winGames:cookieHandle.getCookie("winGames")||0,isGameStart:false,isGameOver:false,playerLastChess:[],AILastChess:[],init:function(){this.chessBoardHtml=$("div.chessboard").html();var a=this;$(".operating-panel a").click(function(b){b.preventDefault();var c=$(this).attr("id");if(a.isGameStart&&c!=="replay_btn"){return}switch(c){case"black_btn":a.humanPlayer="black";a.AIPlayer="white";break;case"white_btn":a.humanPlayer="white";a.AIPlayer="black";break;case"first_move_btn":a.isPlayerTurn=true;break;case"second_move_btn":a.isPlayerTurn=false;break;case"replay_btn":a.resetChessBoard();if(a.isGameStart){a.gameOver()}else{a.gameStart()}break}if(c!=="replay_btn"){$(this).addClass("selected").siblings().removeClass("selected")}});this.resetChessBoard();$("#result_info").html("胜率："+(this.winGames*100/this.totalGames|0)+"%")},resetChessBoard:function(){$("div.chessboard").html(this.chessBoardHtml);$("#result_tips").html("");this.isGameOver=false;this.isPlayerTurn=$("#first_move_btn").hasClass("selected");var c,b;for(c=0;c<15;c++){this.chessArr[c]=[];for(b=0;b<15;b++){this.chessArr[c][b]=this.NO_CHESS}}var a=this;$("div.chessboard div").click(function(){if(!a.isPlayerTurn||a.isGameOver){return}if(!a.isGameStart){a.gameStart()}var e=$(this).index(),f=e/15|0,d=e%15;if(a.chessArr[f][d]===a.NO_CHESS){a.playChess(f,d,a.humanPlayer);if(f===0&&d===0){$(this).removeClass("hover-up-left")}else{if(f===0&&d===14){$(this).removeClass("hover-up-right")}else{if(f===14&&d===0){$(this).removeClass("hover-down-left")}else{if(f===14&&d===14){$(this).removeClass("hover-down-right")}else{if(f===0){$(this).removeClass("hover-up")}else{if(f===14){$(this).removeClass("hover-down")}else{if(d===0){$(this).removeClass("hover-left")}else{if(d===14){$(this).removeClass("hover-right")}else{$(this).removeClass("hover")}}}}}}}}a.playerLastChess=[f,d];a.playerWinOrNot(f,d)}});$("div.chessboard div").hover(function(){if(!a.isPlayerTurn||a.isGameOver){return}var e=$(this).index(),f=e/15|0,d=e%15;if(a.chessArr[f][d]===a.NO_CHESS){if(f===0&&d===0){$(this).addClass("hover-up-left")}else{if(f===0&&d===14){$(this).addClass("hover-up-right")}else{if(f===14&&d===0){$(this).addClass("hover-down-left")}else{if(f===14&&d===14){$(this).addClass("hover-down-right")}else{if(f===0){$(this).addClass("hover-up")}else{if(f===14){$(this).addClass("hover-down")}else{if(d===0){$(this).addClass("hover-left")}else{if(d===14){$(this).addClass("hover-right")}else{$(this).addClass("hover")}}}}}}}}}},function(){if(!a.isPlayerTurn||a.isGameOver){return}var e=$(this).index(),f=e/15|0,d=e%15;if(f===0&&d===0){$(this).removeClass("hover-up-left")}else{if(f===0&&d===14){$(this).removeClass("hover-up-right")}else{if(f===14&&d===0){$(this).removeClass("hover-down-left")}else{if(f===14&&d===14){$(this).removeClass("hover-down-right")}else{if(f===0){$(this).removeClass("hover-up")}else{if(f===14){$(this).removeClass("hover-down")}else{if(d===0){$(this).removeClass("hover-left")}else{if(d===14){$(this).removeClass("hover-right")}else{$(this).removeClass("hover")}}}}}}}}})},gameStart:function(){this.totalGames++;cookieHandle.setCookie({name:"totalGames",value:this.totalGames,expiresHours:365*24});if(!this.isPlayerTurn){this.AImoveChess()}this.isGameStart=true;$(".operating-panel p a").addClass("disable");$("#replay_btn").html("重玩")},gameOver:function(){this.isGameStart=false;$(".operating-panel a").removeClass("disable");$("#replay_btn").html("开始");$("#result_info").html("胜率："+(this.winGames*100/this.totalGames|0)+"%")},playChess:function(c,b,a){this.chessArr[c][b]=a==="black"?this.BLACK_CHESS:this.WHITE_CHESS;if(a===this.AIPlayer){$("div.chessboard div."+a+"-last").addClass(a).removeClass(a+"-last");$("div.chessboard div:eq("+(c*15+b)+")").addClass(a+"-last")}else{$("div.chessboard div:eq("+(c*15+b)+")").addClass(a)}},playerWinOrNot:function(c,b){var e=1,d=this.humanPlayer==="black"?this.BLACK_CHESS:this.WHITE_CHESS,a,f;for(a=b-1;a>=0;a--){if(this.chessArr[c][a]===d){e++}else{break}}for(a=b+1;a<15;a++){if(this.chessArr[c][a]===d){e++}else{break}}if(e>=5){this.playerWin();return}else{e=1}for(a=c-1;a>=0;a--){if(this.chessArr[a][b]===d){e++}else{break}}for(a=c+1;a<15;a++){if(this.chessArr[a][b]===d){e++}else{break}}if(e>=5){this.playerWin();return}else{e=1}for(a=c-1,f=b-1;a>=0&&f>=0;a--,f--){if(this.chessArr[a][f]===d){e++}else{break}}for(a=c+1,f=b+1;a<15&&f<15;a++,f++){if(this.chessArr[a][f]===d){e++}else{break}}if(e>=5){this.playerWin();return}else{e=1}for(a=c-1,f=b+1;a>=0&&f<15;a--,f++){if(this.chessArr[a][f]===d){e++}else{break}}for(a=c+1,f=b-1;a<15&&f>=0;a++,f--){if(this.chessArr[a][f]===d){e++}else{break}}if(e>=5){this.playerWin();return}this.AImoveChess()},playerWin:function(){this.winGames++;cookieHandle.setCookie({name:"winGames",value:this.winGames,expiresHours:365*24});this.showResult(true);this.gameOver()},AImoveChess:function(){this.isPlayerTurn=false;var f=0,e=0,b=0,d,c,a;for(d=14;d>=0;d--){for(c=14;c>=0;c--){if(this.chessArr[d][c]!==this.NO_CHESS){continue}a=this.computeWeight(d,c);if(a>b){b=a;f=d;e=c}}}this.playChess(f,e,this.AIPlayer);this.AILastChess=[f,e];if((b>=100000&&b<250000)||(b>=500000)){this.showResult(false);this.gameOver()}else{this.isPlayerTurn=true}},showResult:function(a){if(a){$("#result_tips").html("恭喜你获胜！")}else{$("#result_tips").html("哈哈，你输咯！")}this.isGameOver=true;this.showWinChesses(a)},showWinChesses:function(b){var f=1,g=[],d,c,e,a,h;if(b){e=this.humanPlayer==="black"?this.BLACK_CHESS:this.WHITE_CHESS;d=this.playerLastChess[0];c=this.playerLastChess[1]}else{e=this.AIPlayer==="black"?this.BLACK_CHESS:this.WHITE_CHESS;d=this.AILastChess[0];c=this.AILastChess[1]}$("div.chessboard div."+this.AIPlayer+"-last").addClass(this.AIPlayer).removeClass(this.AIPlayer+"-last");g[0]=[d];g[1]=[c];for(a=c-1;a>=0;a--){if(this.chessArr[d][a]===e){g[0][f]=d;g[1][f]=a;f++}else{break}}for(a=c+1;a<15;a++){if(this.chessArr[d][a]===e){g[0][f]=d;g[1][f]=a;f++}else{break}}if(f>=5){for(k=f-1;k>=0;k--){this.markChess(g[0][k]*15+g[1][k],b?this.humanPlayer:this.AIPlayer)}return}f=1;g[0]=[d];g[1]=[c];for(a=d-1;a>=0;a--){if(this.chessArr[a][c]===e){g[0][f]=a;g[1][f]=c;f++}else{break}}for(a=d+1;a<15;a++){if(this.chessArr[a][c]===e){g[0][f]=a;g[1][f]=c;f++}else{break}}if(f>=5){for(k=f-1;k>=0;k--){this.markChess(g[0][k]*15+g[1][k],b?this.humanPlayer:this.AIPlayer)}return}f=1;g[0]=[d];g[1]=[c];for(a=d-1,h=c-1;a>=0&&h>=0;a--,h--){if(this.chessArr[a][h]===e){g[0][f]=a;g[1][f]=h;f++}else{break}}for(a=d+1,h=c+1;a<15&&h<15;a++,h++){if(this.chessArr[a][h]===e){g[0][f]=a;g[1][f]=h;f++}else{break}}if(f>=5){for(k=f-1;k>=0;k--){this.markChess(g[0][k]*15+g[1][k],b?this.humanPlayer:this.AIPlayer)}return}f=1;g[0]=[d];g[1]=[c];for(a=d-1,h=c+1;a>=0&&h<15;a--,h++){if(this.chessArr[a][h]===e){g[0][f]=a;g[1][f]=h;f++}else{break}}for(a=d+1,h=c-1;a<15&&h>=0;a++,h--){if(this.chessArr[a][h]===e){g[0][f]=a;g[1][f]=h;f++}else{break}}if(f>=5){for(k=f-1;k>=0;k--){this.markChess(g[0][k]*15+g[1][k],b?this.humanPlayer:this.AIPlayer)}}},markChess:function(b,a){$("div.chessboard div:eq("+b+")").removeClass(a).addClass(a+"-last")},putDirectX:function(c,b,e){var a,h,g=1,f=false,d=false;for(a=b-1;a>=0;a--){if(this.chessArr[c][a]===e){g++}else{if(this.chessArr[c][a]===this.NO_CHESS){f=true}break}}for(a=b+1;a<15;a++){if(this.chessArr[c][a]===e){g++}else{if(this.chessArr[c][a]===this.NO_CHESS){d=true}break}}return{nums:g,side1:f,side2:d}},putDirectY:function(c,b,e){var a,h,g=1,f=false,d=false;for(a=c-1;a>=0;a--){if(this.chessArr[a][b]===e){g++}else{if(this.chessArr[a][b]===this.NO_CHESS){f=true}break}}for(a=c+1;a<15;a++){if(this.chessArr[a][b]===e){g++}else{if(this.chessArr[a][b]===this.NO_CHESS){d=true}break}}return{nums:g,side1:f,side2:d}},putDirectXY:function(c,b,e){var a,h,g=1,f=false,d=false;for(a=c-1,h=b-1;a>=0&&h>=0;a--,h--){if(this.chessArr[a][h]===e){g++}else{if(this.chessArr[a][h]===this.NO_CHESS){f=true}break}}for(a=c+1,h=b+1;a<15&&h<15;a++,h++){if(this.chessArr[a][h]===e){g++}else{if(this.chessArr[a][h]===this.NO_CHESS){d=true}break}}return{nums:g,side1:f,side2:d}},putDirectYX:function(c,b,e){var a,h,g=1,f=false,d=false;for(a=c-1,h=b+1;a>=0&&h<15;a--,h++){if(this.chessArr[a][h]===e){g++}else{if(this.chessArr[a][h]===this.NO_CHESS){f=true}break}}for(a=c+1,h=b-1;a<15&&h>=0;a++,h--){if(this.chessArr[a][h]===e){g++}else{if(this.chessArr[a][h]===this.NO_CHESS){d=true}break}}return{nums:g,side1:f,side2:d}},computeWeight:function(c,b){var e=14-(Math.abs(c-7)+Math.abs(b-7)),a={},d=this.AIPlayer==="black"?this.BLACK_CHESS:this.WHITE_CHESS;a=this.putDirectX(c,b,d);e+=this.weightStatus(a.nums,a.side1,a.side2,true);a=this.putDirectX(c,b,-d);e+=this.weightStatus(a.nums,a.side1,a.side2,false);a=this.putDirectY(c,b,d);e+=this.weightStatus(a.nums,a.side1,a.side2,true);a=this.putDirectY(c,b,-d);e+=this.weightStatus(a.nums,a.side1,a.side2,false);a=this.putDirectXY(c,b,d);e+=this.weightStatus(a.nums,a.side1,a.side2,true);a=this.putDirectXY(c,b,-d);e+=this.weightStatus(a.nums,a.side1,a.side2,false);a=this.putDirectYX(c,b,d);e+=this.weightStatus(a.nums,a.side1,a.side2,true);a=this.putDirectYX(c,b,-d);e+=this.weightStatus(a.nums,a.side1,a.side2,false);return e},weightStatus:function(e,b,a,d){var c=0;switch(e){case 1:if(b&&a){c=d?15:10}break;case 2:if(b&&a){c=d?100:50}else{if(b||a){c=d?10:5}}break;case 3:if(b&&a){c=d?500:200}else{if(b||a){c=d?30:20}}break;case 4:if(b&&a){c=d?5000:2000}else{if(b||a){c=d?400:100}}break;case 5:c=d?100000:10000;break;default:c=d?500000:250000;break}return c}};