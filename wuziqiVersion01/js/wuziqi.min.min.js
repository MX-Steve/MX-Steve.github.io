$(document).ready(function(){fiveChess.init()});var fiveChess={NO_CHESS:0,BLACK_CHESS:-1,WHITE_CHESS:1,chessArr:[],chessBoardHtml:"",humanPlayer:"black",AIPlayer:"white",isPlayerTurn:true,totalGames:cookieHandle.getCookie("totalGames")||0,winGames:cookieHandle.getCookie("winGames")||0,isGameStart:false,isGameOver:false,playerLastChess:[],AILastChess:[],init:function(){this.chessBoardHtml=$("div.chessboard").html();var b=this;$(".operating-panel a").click(function(a){a.preventDefault();var d=$(this).attr("id");if(b.isGameStart&&d!=="replay_btn"){return}switch(d){case"black_btn":b.humanPlayer="black";b.AIPlayer="white";break;case"white_btn":b.humanPlayer="white";b.AIPlayer="black";break;case"first_move_btn":b.isPlayerTurn=true;break;case"second_move_btn":b.isPlayerTurn=false;break;case"replay_btn":b.resetChessBoard();if(b.isGameStart){b.gameOver()}else{b.gameStart()}break}if(d!=="replay_btn"){$(this).addClass("selected").siblings().removeClass("selected")}});this.resetChessBoard();$("#result_info").html("胜率："+(this.winGames*100/this.totalGames|0)+"%")},resetChessBoard:function(){$("div.chessboard").html(this.chessBoardHtml);$("#result_tips").html("");this.isGameOver=false;this.isPlayerTurn=$("#first_move_btn").hasClass("selected");var f,d;for(f=0;f<15;f++){this.chessArr[f]=[];for(d=0;d<15;d++){this.chessArr[f][d]=this.NO_CHESS}}var e=this;$("div.chessboard div").click(function(){if(!e.isPlayerTurn||e.isGameOver){return}if(!e.isGameStart){e.gameStart()}var b=$(this).index(),a=b/15|0,c=b%15;if(e.chessArr[a][c]===e.NO_CHESS){e.playChess(a,c,e.humanPlayer);if(a===0&&c===0){$(this).removeClass("hover-up-left")}else{if(a===0&&c===14){$(this).removeClass("hover-up-right")}else{if(a===14&&c===0){$(this).removeClass("hover-down-left")}else{if(a===14&&c===14){$(this).removeClass("hover-down-right")}else{if(a===0){$(this).removeClass("hover-up")}else{if(a===14){$(this).removeClass("hover-down")}else{if(c===0){$(this).removeClass("hover-left")}else{if(c===14){$(this).removeClass("hover-right")}else{$(this).removeClass("hover")}}}}}}}}e.playerLastChess=[a,c];e.playerWinOrNot(a,c)}});$("div.chessboard div").hover(function(){if(!e.isPlayerTurn||e.isGameOver){return}var b=$(this).index(),a=b/15|0,c=b%15;if(e.chessArr[a][c]===e.NO_CHESS){if(a===0&&c===0){$(this).addClass("hover-up-left")}else{if(a===0&&c===14){$(this).addClass("hover-up-right")}else{if(a===14&&c===0){$(this).addClass("hover-down-left")}else{if(a===14&&c===14){$(this).addClass("hover-down-right")}else{if(a===0){$(this).addClass("hover-up")}else{if(a===14){$(this).addClass("hover-down")}else{if(c===0){$(this).addClass("hover-left")}else{if(c===14){$(this).addClass("hover-right")}else{$(this).addClass("hover")}}}}}}}}}},function(){if(!e.isPlayerTurn||e.isGameOver){return}var b=$(this).index(),a=b/15|0,c=b%15;if(a===0&&c===0){$(this).removeClass("hover-up-left")}else{if(a===0&&c===14){$(this).removeClass("hover-up-right")}else{if(a===14&&c===0){$(this).removeClass("hover-down-left")}else{if(a===14&&c===14){$(this).removeClass("hover-down-right")}else{if(a===0){$(this).removeClass("hover-up")}else{if(a===14){$(this).removeClass("hover-down")}else{if(c===0){$(this).removeClass("hover-left")}else{if(c===14){$(this).removeClass("hover-right")}else{$(this).removeClass("hover")}}}}}}}}})},gameStart:function(){this.totalGames++;cookieHandle.setCookie({name:"totalGames",value:this.totalGames,expiresHours:365*24});if(!this.isPlayerTurn){this.AImoveChess()}this.isGameStart=true;$(".operating-panel p a").addClass("disable");$("#replay_btn").html("重玩")},gameOver:function(){this.isGameStart=false;$(".operating-panel a").removeClass("disable");$("#replay_btn").html("开始");$("#result_info").html("胜率："+(this.winGames*100/this.totalGames|0)+"%")},playChess:function(f,d,e){this.chessArr[f][d]=e==="black"?this.BLACK_CHESS:this.WHITE_CHESS;if(e===this.AIPlayer){$("div.chessboard div."+e+"-last").addClass(e).removeClass(e+"-last");$("div.chessboard div:eq("+(f*15+d)+")").addClass(e+"-last")}else{$("div.chessboard div:eq("+(f*15+d)+")").addClass(e)}},playerWinOrNot:function(m,g){var j=1,l=this.humanPlayer==="black"?this.BLACK_CHESS:this.WHITE_CHESS,h,i;for(h=g-1;h>=0;h--){if(this.chessArr[m][h]===l){j++}else{break}}for(h=g+1;h<15;h++){if(this.chessArr[m][h]===l){j++}else{break}}if(j>=5){this.playerWin();return}else{j=1}for(h=m-1;h>=0;h--){if(this.chessArr[h][g]===l){j++}else{break}}for(h=m+1;h<15;h++){if(this.chessArr[h][g]===l){j++}else{break}}if(j>=5){this.playerWin();return}else{j=1}for(h=m-1,i=g-1;h>=0&&i>=0;h--,i--){if(this.chessArr[h][i]===l){j++}else{break}}for(h=m+1,i=g+1;h<15&&i<15;h++,i++){if(this.chessArr[h][i]===l){j++}else{break}}if(j>=5){this.playerWin();return}else{j=1}for(h=m-1,i=g+1;h>=0&&i<15;h--,i++){if(this.chessArr[h][i]===l){j++}else{break}}for(h=m+1,i=g-1;h<15&&i>=0;h++,i--){if(this.chessArr[h][i]===l){j++}else{break}}if(j>=5){this.playerWin();return}this.AImoveChess()},playerWin:function(){this.winGames++;cookieHandle.setCookie({name:"winGames",value:this.winGames,expiresHours:365*24});this.showResult(true);this.gameOver()},AImoveChess:function(){this.isPlayerTurn=false;var i=0,j=0,g=0,l,m,h;for(l=14;l>=0;l--){for(m=14;m>=0;m--){if(this.chessArr[l][m]!==this.NO_CHESS){continue}h=this.computeWeight(l,m);if(h>g){g=h;i=l;j=m}}}this.playChess(i,j,this.AIPlayer);this.AILastChess=[i,j];if((g>=100000&&g<250000)||(g>=500000)){this.showResult(false);this.gameOver()}else{this.isPlayerTurn=true}},showResult:function(b){if(b){$("#result_tips").html("恭喜你获胜！")}else{$("#result_tips").html("哈哈，你输咯！")}this.isGameOver=true;this.showWinChesses(b)},showWinChesses:function(i){var n=1,m=[],p,q,o,j,l;if(i){o=this.humanPlayer==="black"?this.BLACK_CHESS:this.WHITE_CHESS;p=this.playerLastChess[0];q=this.playerLastChess[1]}else{o=this.AIPlayer==="black"?this.BLACK_CHESS:this.WHITE_CHESS;p=this.AILastChess[0];q=this.AILastChess[1]}$("div.chessboard div."+this.AIPlayer+"-last").addClass(this.AIPlayer).removeClass(this.AIPlayer+"-last");m[0]=[p];m[1]=[q];for(j=q-1;j>=0;j--){if(this.chessArr[p][j]===o){m[0][n]=p;m[1][n]=j;n++}else{break}}for(j=q+1;j<15;j++){if(this.chessArr[p][j]===o){m[0][n]=p;m[1][n]=j;n++}else{break}}if(n>=5){for(k=n-1;k>=0;k--){this.markChess(m[0][k]*15+m[1][k],i?this.humanPlayer:this.AIPlayer)}return}n=1;m[0]=[p];m[1]=[q];for(j=p-1;j>=0;j--){if(this.chessArr[j][q]===o){m[0][n]=j;m[1][n]=q;n++}else{break}}for(j=p+1;j<15;j++){if(this.chessArr[j][q]===o){m[0][n]=j;m[1][n]=q;n++}else{break}}if(n>=5){for(k=n-1;k>=0;k--){this.markChess(m[0][k]*15+m[1][k],i?this.humanPlayer:this.AIPlayer)}return}n=1;m[0]=[p];m[1]=[q];for(j=p-1,l=q-1;j>=0&&l>=0;j--,l--){if(this.chessArr[j][l]===o){m[0][n]=j;m[1][n]=l;n++}else{break}}for(j=p+1,l=q+1;j<15&&l<15;j++,l++){if(this.chessArr[j][l]===o){m[0][n]=j;m[1][n]=l;n++}else{break}}if(n>=5){for(k=n-1;k>=0;k--){this.markChess(m[0][k]*15+m[1][k],i?this.humanPlayer:this.AIPlayer)}return}n=1;m[0]=[p];m[1]=[q];for(j=p-1,l=q+1;j>=0&&l<15;j--,l++){if(this.chessArr[j][l]===o){m[0][n]=j;m[1][n]=l;n++}else{break}}for(j=p+1,l=q-1;j<15&&l>=0;j++,l--){if(this.chessArr[j][l]===o){m[0][n]=j;m[1][n]=l;n++}else{break}}if(n>=5){for(k=n-1;k>=0;k--){this.markChess(m[0][k]*15+m[1][k],i?this.humanPlayer:this.AIPlayer)}}},markChess:function(c,d){$("div.chessboard div:eq("+c+")").removeClass(d).addClass(d+"-last")},putDirectX:function(q,i,o){var j,l,m=1,n=false,p=false;for(j=i-1;j>=0;j--){if(this.chessArr[q][j]===o){m++}else{if(this.chessArr[q][j]===this.NO_CHESS){n=true}break}}for(j=i+1;j<15;j++){if(this.chessArr[q][j]===o){m++}else{if(this.chessArr[q][j]===this.NO_CHESS){p=true}break}}return{nums:m,side1:n,side2:p}},putDirectY:function(q,i,o){var j,l,m=1,n=false,p=false;for(j=q-1;j>=0;j--){if(this.chessArr[j][i]===o){m++}else{if(this.chessArr[j][i]===this.NO_CHESS){n=true}break}}for(j=q+1;j<15;j++){if(this.chessArr[j][i]===o){m++}else{if(this.chessArr[j][i]===this.NO_CHESS){p=true}break}}return{nums:m,side1:n,side2:p}},putDirectXY:function(q,i,o){var j,l,m=1,n=false,p=false;for(j=q-1,l=i-1;j>=0&&l>=0;j--,l--){if(this.chessArr[j][l]===o){m++}else{if(this.chessArr[j][l]===this.NO_CHESS){n=true}break}}for(j=q+1,l=i+1;j<15&&l<15;j++,l++){if(this.chessArr[j][l]===o){m++}else{if(this.chessArr[j][l]===this.NO_CHESS){p=true}break}}return{nums:m,side1:n,side2:p}},putDirectYX:function(q,i,o){var j,l,m=1,n=false,p=false;for(j=q-1,l=i+1;j>=0&&l<15;j--,l++){if(this.chessArr[j][l]===o){m++}else{if(this.chessArr[j][l]===this.NO_CHESS){n=true}break}}for(j=q+1,l=i-1;j<15&&l>=0;j++,l--){if(this.chessArr[j][l]===o){m++}else{if(this.chessArr[j][l]===this.NO_CHESS){p=true}break}}return{nums:m,side1:n,side2:p}},computeWeight:function(j,f){var h=14-(Math.abs(j-7)+Math.abs(f-7)),g={},i=this.AIPlayer==="black"?this.BLACK_CHESS:this.WHITE_CHESS;g=this.putDirectX(j,f,i);h+=this.weightStatus(g.nums,g.side1,g.side2,true);g=this.putDirectX(j,f,-i);h+=this.weightStatus(g.nums,g.side1,g.side2,false);g=this.putDirectY(j,f,i);h+=this.weightStatus(g.nums,g.side1,g.side2,true);g=this.putDirectY(j,f,-i);h+=this.weightStatus(g.nums,g.side1,g.side2,false);g=this.putDirectXY(j,f,i);h+=this.weightStatus(g.nums,g.side1,g.side2,true);g=this.putDirectXY(j,f,-i);h+=this.weightStatus(g.nums,g.side1,g.side2,false);g=this.putDirectYX(j,f,i);h+=this.weightStatus(g.nums,g.side1,g.side2,true);g=this.putDirectYX(j,f,-i);h+=this.weightStatus(g.nums,g.side1,g.side2,false);return h},weightStatus:function(h,f,g,i){var j=0;switch(h){case 1:if(f&&g){j=i?15:10}break;case 2:if(f&&g){j=i?100:50}else{if(f||g){j=i?10:5}}break;case 3:if(f&&g){j=i?500:200}else{if(f||g){j=i?30:20}}break;case 4:if(f&&g){j=i?5000:2000}else{if(f||g){j=i?400:100}}break;case 5:j=i?100000:10000;break;default:j=i?500000:250000;break}return j}};